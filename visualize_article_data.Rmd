---
title: "Article Metadata Summaries"
author: "Toph Allen"
date: "4/9/2019"
output: github_document
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(scales)
library(here)

ktable <- function(...) {
  knitr::kable(table(...)) %>%
    kable_styling(bootstrap_options = c("hover", "condensed", "responsive"),
                  full_width = FALSE,
                  position = "left")
}
```

```{r load}
articles <- read_csv(here("data", "articles.csv")) %>%
  select(-X1, -id_types, -keywords)
id_types <- read_csv(here("data", "id_types.csv")) %>%
  select(-X1)
keywords <- read_csv(here("data", "keywords.csv")) %>%
  select(-X1)
text_matches <- read_csv(here("data", "text_matches.csv")) %>%
  select(-X1)
geonames <- read_csv(here("data", "geonames.csv")) %>%
  select(-X1)
```


## Prevalence of Text Matches

We search for four phrases in the extracted text: "field work", "fieldwork", "field study" and "study site".

Matching articles are a smallish subset of the total, `r sum(articles$any_matches) / nrow(articles) * 100`%.

```{r text_matches_1}
ktable(articles$any_matches)
ktable(articles$text_matches)
```

```{r text_matches_2}
text_matches %>%
  filter(!is.na(text_matches)) %>%
  ggplot(aes(x = factor(text_matches))) +
  geom_bar(stat = "count") +
  theme_bw()
```

## Examining characteristics of the subset

I pulled a few pieces of metadata for our subset of articles. These include:

- What type of article is it?
- Does it have a `<body>` tag?
- How long is it?
- Associated keywords
- What types of document identifiers does it have?

### Article types

There are many article types, but only a few which are widely used.

```{r article_types_1}
articles %<>%
  mutate(article_type = fct_infreq(article_type))
ktable(articles$article_type)
```

```{r article_types_2}
articles %>% 
  group_by(article_type) %>%
  mutate(n = n()) %>%
  filter(n > 50) %>%
  ungroup() %>%
  ggplot(aes(x = factor(article_type))) +
  geom_bar() +
  theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Does the usage of these differ between the fieldwork subset?

```{r article_types_3}
articles %>% 
  group_by(any_matches) %>%
  mutate(n_matches = n()) %>%
  group_by(any_matches, article_type) %>%
  summarize(type_freq = (n() / n_matches)[1]) %>%
  ungroup() %>%
  group_by(article_type) %>%
  filter(n() > 1) %>%
  ungroup() %>%
  ggplot(aes(x = factor(article_type), y = type_freq, fill = any_matches)) +
  geom_col(position = "dodge") +
  theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

There are more research articles, and fewer of everything else.

### Presence of `<body>` tag

```{r body_tag}
ktable(articles$has_body)
ktable(articles$article_type, articles$has_body)
```

### Length

```{r length_1}
types <- articles %>%
  group_by(any_matches) %>%
  mutate(match_n = n()) %>%
  group_by(article_type) %>%
  mutate(type_n = n()) %>%
  group_by(any_matches, article_type) %>%
  summarize(match_x_type = n(),
            match_n = match_n[1],
            type_n = type_n[1]) %>%
  ungroup() %>%
  mutate(x_over_match = match_x_type / match_n,
         x_over_type = match_x_type / type_n)

type_filter <- types %>%
  filter(x_over_match > 0.005) %>%
  group_by(article_type) %>%
  filter(n() > 1) %>%
  pull(article_type) %>%
  unique()
```

```{r length_2}
ggplot(articles, aes(x = text_length)) +
  geom_density() +
  scale_x_log10(labels = comma) +
  theme_bw()

ggplot(articles, aes(x = text_length, fill = any_matches)) +
  geom_density(alpha = 0.5) +
  scale_x_log10(labels = comma) +
  theme_bw()

articles %>%
  group_by(article_type) %>%
  filter(n() > 100) %>%
  ggplot(aes(x = text_length, fill = article_type)) +
  geom_density(alpha = 0.25) +
  scale_x_log10(labels = comma) +
  theme_bw()

articles %>%
  filter(article_type %in% type_filter) %>%
  ggplot(aes(x = text_length, fill = article_type)) +
  geom_density() +
  scale_x_log10(labels = comma) +
  facet_grid(article_type ~ any_matches) +
  theme_bw()
```


### Usage of Keywords

```{r keywords_1}
keywords_per_paper <- keywords %>%
  group_by(id) %>%
  summarize(any_matches = unique(any_matches),
            n = n())
```

A total of `r nrow(keywords_per_paper)` papers out of `r nrow(articles)` (`r nrow(keywords_per_paper)/nrow(articles) * 100`%) had keywords.

For those matching fieldwork terms:

```{r keywords_2}
k <- keywords_per_paper %>%
  filter(any_matches == TRUE) %>%
  nrow()
nk <- articles %>%
  filter(any_matches == TRUE) %>%
  nrow()

k / nk * 100
```

For those not matching fieldwork terms:

```{r keywords_3}
k <- keywords_per_paper %>%
  filter(any_matches == FALSE) %>%
  nrow()
nk <- articles %>%
  filter(any_matches == FALSE) %>%
  nrow()

k / nk * 100
```

These are the top twenty-five keywords used in all documents:

```{r keywords_4}
keyword_summary <- keywords %>%
  group_by(keywords) %>%
  summarize(n = n()) %>%
  arrange(-n) %>%
  head(25)

knitr::kable(keyword_summary) %>%
  kable_styling(bootstrap_options = c("hover", "condensed", "responsive"),
                full_width = FALSE,
                position = "left")
```

For those matching fieldwork terms:

```{r keywords_5}
fw_keyword_summary <- keywords %>%
  filter(any_matches == TRUE) %>%
  group_by(keywords) %>%
  summarize(n = n()) %>%
  arrange(-n) %>%
  head(25)

knitr::kable(fw_keyword_summary) %>%
  kable_styling(bootstrap_options = c("hover", "condensed", "responsive"),
                full_width = FALSE,
                position = "left")
```

And those with no matches for fieldwork terms:

```{r keywords_6}
nofw_keyword_summary <- keywords %>%
  filter(any_matches == FALSE) %>%
  group_by(keywords) %>%
  summarize(n = n()) %>%
  arrange(-n) %>%
  head(25)

knitr::kable(nofw_keyword_summary) %>%
  kable_styling(bootstrap_options = c("hover", "condensed", "responsive"),
                full_width = FALSE,
                position = "left")
```


## GeoNames

It looks like articles that match the fieldwork terms have many more geonames in them than those that don't.

```{r geonames}
summary(geonames)
geonames %>% filter(any_matches == FALSE) %>% summary
geonames %>% filter(any_matches == TRUE) %>% summary
```


## Summary

We should use documents which

- match this set of search terms;
- have a `<body>` tag;
- are a `"research-article"`.

We could also consider including `"review-article"` and `"brief-report"` types, but those seem fairly uncommon.